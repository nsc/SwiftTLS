//
//  TLSServerKeyExchangeTests.swift
//  SwiftTLS
//
//  Created by Nico Schmidt on 31.12.15.
//  Copyright Â© 2015 Nico Schmidt. All rights reserved.
//

import XCTest
@testable import SwiftTLS

class TLSServerKeyExchangeTests: XCTestCase {

    func test_handshakeMessageFromData_thatRepresentsAServerKeyExchange_actuallyCreatesAServerKeyExchange()
    {
        let rawPacket : [UInt8] = [22, 3, 3, 3, 15, 12, 0, 3, 11, 1, 0, 182, 103, 27, 194, 98, 48, 59, 250, 131, 68, 193, 245, 139, 51, 42, 183, 128, 215, 19, 156, 155, 210, 211, 13, 245, 206, 144, 187, 223, 157, 154, 166, 200, 77, 7, 41, 253, 23, 244, 77, 154, 251, 97, 167, 32, 18, 88, 137, 11, 155, 64, 9, 14, 170, 108, 1, 125, 188, 165, 220, 223, 214, 226, 63, 74, 24, 253, 10, 219, 19, 219, 23, 42, 24, 78, 51, 232, 127, 242, 229, 38, 202, 104, 183, 143, 152, 196, 127, 164, 217, 251, 190, 20, 210, 156, 54, 120, 23, 44, 53, 193, 50, 60, 220, 115, 191, 93, 61, 182, 114, 2, 244, 246, 43, 191, 245, 143, 49, 49, 182, 227, 253, 65, 190, 148, 148, 147, 133, 115, 245, 1, 253, 216, 108, 114, 211, 7, 153, 245, 233, 127, 9, 95, 235, 36, 210, 191, 237, 234, 77, 64, 122, 251, 168, 222, 111, 253, 219, 230, 3, 56, 210, 76, 37, 146, 91, 54, 232, 4, 132, 104, 50, 82, 181, 15, 208, 33, 52, 214, 21, 71, 189, 158, 224, 33, 146, 163, 4, 46, 205, 181, 48, 255, 77, 84, 151, 52, 142, 241, 82, 179, 163, 154, 19, 198, 190, 186, 137, 50, 23, 189, 119, 195, 67, 176, 6, 98, 48, 90, 171, 84, 58, 246, 49, 206, 208, 220, 197, 219, 59, 55, 19, 104, 35, 150, 208, 228, 131, 230, 143, 164, 222, 161, 196, 85, 155, 88, 195, 13, 176, 26, 141, 242, 173, 99, 83, 0, 1, 2, 1, 0, 13, 92, 45, 84, 196, 13, 255, 158, 222, 203, 161, 215, 204, 113, 206, 6, 194, 86, 221, 123, 173, 5, 43, 66, 190, 140, 255, 163, 36, 232, 52, 123, 231, 45, 133, 167, 104, 186, 64, 217, 204, 116, 6, 40, 200, 158, 190, 0, 147, 134, 50, 224, 33, 234, 49, 112, 240, 209, 55, 197, 103, 66, 165, 251, 111, 121, 203, 217, 38, 179, 251, 127, 49, 69, 168, 60, 144, 249, 69, 143, 247, 38, 91, 134, 138, 126, 202, 171, 237, 86, 217, 148, 130, 138, 225, 222, 96, 86, 56, 152, 171, 114, 143, 131, 108, 58, 151, 86, 78, 248, 146, 41, 181, 236, 62, 247, 235, 68, 147, 104, 79, 122, 149, 171, 47, 47, 32, 124, 76, 146, 172, 181, 253, 228, 37, 107, 57, 197, 252, 237, 104, 163, 173, 117, 1, 125, 48, 171, 207, 124, 114, 215, 167, 131, 253, 11, 147, 164, 76, 44, 5, 77, 161, 32, 185, 146, 97, 15, 21, 246, 44, 244, 53, 182, 120, 125, 216, 148, 22, 88, 234, 153, 253, 5, 210, 48, 19, 25, 251, 229, 68, 55, 228, 88, 77, 115, 146, 75, 109, 231, 74, 188, 19, 112, 120, 255, 219, 95, 126, 60, 227, 22, 133, 154, 144, 22, 247, 245, 244, 164, 3, 33, 41, 124, 240, 77, 100, 125, 121, 213, 168, 97, 28, 45, 50, 40, 213, 82, 254, 167, 164, 183, 101, 188, 253, 104, 95, 170, 253, 174, 37, 16, 25, 158, 146, 84, 2, 1, 1, 0, 108, 11, 141, 250, 22, 12, 76, 138, 99, 81, 167, 116, 99, 80, 211, 57, 177, 250, 209, 68, 23, 37, 2, 232, 123, 105, 96, 33, 207, 61, 34, 193, 77, 110, 205, 244, 253, 49, 88, 62, 85, 55, 3, 138, 216, 235, 248, 32, 69, 101, 234, 231, 111, 163, 252, 187, 69, 238, 3, 66, 110, 190, 140, 251, 108, 2, 17, 71, 117, 115, 168, 201, 76, 138, 179, 190, 73, 207, 109, 59, 255, 181, 180, 117, 43, 217, 133, 88, 179, 153, 164, 125, 27, 34, 244, 169, 20, 219, 83, 199, 241, 3, 30, 21, 217, 19, 239, 82, 86, 154, 155, 98, 84, 8, 72, 80, 126, 174, 178, 179, 70, 145, 3, 98, 11, 24, 16, 19, 184, 220, 157, 176, 43, 127, 114, 236, 63, 190, 104, 219, 179, 52, 51, 136, 120, 84, 102, 146, 67, 200, 51, 102, 155, 129, 66, 47, 131, 39, 9, 86, 73, 195, 186, 70, 122, 153, 109, 225, 118, 6, 109, 154, 174, 156, 203, 53, 240, 48, 208, 212, 218, 206, 165, 187, 109, 159, 126, 23, 33, 208, 84, 14, 60, 7, 233, 160, 158, 64, 139, 248, 248, 90, 160, 201, 23, 87, 180, 237, 124, 47, 130, 94, 220, 195, 37, 191, 51, 26, 51, 237, 155, 141, 106, 106, 28, 207, 220, 96, 204, 20, 89, 33, 210, 198, 36, 174, 252, 3, 27, 65, 224, 57, 62, 50, 108, 92, 3, 239, 240, 6, 193, 216, 162, 204, 36, 48]
        
        
        let context = TLSContext()
        context.configuration.protocolVersion = .TLS_v1_2
        context.negotiatedProtocolVersion = context.configuration.protocolVersion
        context.configuration.hashAlgorithm = .SHA1
        context.configuration.signatureAlgorithm = .RSA
        context.cipherSuite = .TLS_DHE_RSA_WITH_AES_256_CBC_SHA
        
        let packetWithoutRecordHeader = [UInt8](rawPacket[5 ..< rawPacket.count])
        let message = TLSHandshakeMessage.handshakeMessageFromData(packetWithoutRecordHeader, context: context)
      
        guard message as? TLSServerKeyExchange != nil else {
            XCTFail()
            return
        }

        XCTAssert(true)
    }
}
